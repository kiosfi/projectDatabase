
<!--
A form for project state change.
-->
<section data-ng-controller="ProjectsController" data-ng-init="findOne()">
    <article>
        <h1><span>{{project.project_ref}}: {{project.title}}</span></h1>
        <hr>
    </article>
    <article class="panel panel-primary">
        <div class="panel-heading"><h4>Yhteenveto</h4></div>
        <section class="panel-body">
            <section class="col-md-12">
                <h4>{{fieldNames["coordinator"]}}: {{project.coordinator}}</h4>
            </section>
            &nbsp;
            <hr>
            <section class="col-md-12">
                <div class="col-md-6">
                    <h4>Hanke</h4>
                    <section class="section">
                        <div class="col-md-6 mini-header">{{fieldNames["dac"]}}</div>
                        <div class="col-md-6">{{project.dac}}&nbsp;</div>
                        <div class="col-md-6 mini-header">
                            {{fieldNames["reg_date"]}}
                        </div>
                        <div class="col-md-6">
                            {{project.reg_date| date:'dd.MM.yyyy'}}
                        </div>
                        <div ng-show="project.approved.granted_sum_eur" class="ng-hide">
                            <div
                                class="col-md-6 mini-header">
                                Myönnetty avustus
                                <!--{{fieldNames["approved_granted_sum_eur"]}}-->
                            </div>
                            <div class="col-md-6">
                                {{project.approved.granted_sum_eur| currency : ""}} EUR
                            </div>
                        </div>
                        <div ng-show="!project.approved.granted_sum_eur" class="ng-hide">
                            <div class="col-md-6 mini-header">
                                Haettu avustus
                            </div>
                            <div class="col-md-6">
                                {{ project.funding.applied_curr_eur | currency : "EUR" : 2 }}
                                ({{ project.funding.applied_curr_local | currency : "" }}
                                paikallinen)
                            </div>
                        </div>
                        <div class="col-md-6 mini-header">Kesto</div>
                        <div class="col-md-6">{{project.duration_months}} kk</div>
                    </section>
                </div>
                <div class="col-md-6">
                    <h4>{{fieldNames["organisation"]}}</h4>
                    <section class="section">
                        <div class="col-md-3 mini-header">{{fieldNames["organisation_name"]}}</div>
                        <div class="col-md-9">{{project.organisation.name}}</div>
                        <div class="col-md-3 mini-header">{{fieldNames["organisation_representative"]}}</div>
                        <div class="col-md-9">
                            {{project.organisation.representative.name}}<br>
                            {{project.organisation.representative.email}}<br>
                            {{project.organisation.representative.phone}}
                        </div>
                    </section>
                </div>
            </section>
            &nbsp;
            <hr>
            <section class="col-md-12">
                <h4>Kuvaus</h4>
                <section class="section">
                    <span ng-bind-html="handleEmphasis(project.description)">
                    </span>
                </section>
            </section>
        </section>
    </article>
    <article class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span>Tilasiirtymä {{ project.state }}</span>
                <span class="glyphicon glyphicon-arrow-right"></span>
                <span>{{ global.newState }}</span>
            </h4>
        </div>
        <div class="panel-body">
            <!--    Käsittelyssä -->
            <form   name="inReviewForm"
                    class="form-horizontal"
                    ng-show="global.newState === 'käsittelyssä'"
                    role="form"
                    data-ng-submit="addReviewState(inReviewForm.$valid)" novalidate>
                <div class="form-group">
                    <div class="col-md-4">
                        <!--{{fieldNames["required_appendices"]}}-->
                        <label class="col-md-12" class="control-label">Toimitetut liitteet</label>
                        <span class="col-md-8">{{fieldNames["required_appendices_proj_budget"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.proj_budget" id="proj_budget" name="proj_budget">
                        <span class="col-md-8">{{fieldNames["required_appendices_references"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.references" id="references" name="references">
                        <span class="col-md-8">{{fieldNames["required_appendices_annual_budget"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.annual_budget" id="annual_budget" name="annual_budget">
                        <span class="col-md-8">{{fieldNames["required_appendices_rules"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.rules" id="rules" name="rules">
                        <span class="col-md-8">{{fieldNames["required_appendices_reg_cert"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.reg_cert" id="reg_cert" name="reg_cert">
                        <span class="col-md-8">{{fieldNames["required_appendices_annual_report"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.annual_report" id="annual_report" name="annual_report">
                        <span class="col-md-8">{{fieldNames["required_appendices_audit_reports"]}}</span>
                        <input class="col-md-4" type="checkbox" ng-model="project.required_appendices.audit_reports" id="audit_reports" name="audit_reports">
                    </div>
                    <div class="col-md-8">
                        <label for="comments" class="col-md-12" class="control-label">{{fieldNames["in_review_comments"]}}</label>
                        <div class="col-md-12">
                            <textarea   name="comments"
                                        type="text"
                                        class="form-control"
                                        data-ng-model="project.in_review.comments"
                                        id="comments"
                                        rows="5">
                            </textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="review-button" type="submit" class="btn btn-primary"
                            ng-disabled="inReviewForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!-- Hyväksytty -->
            <form name="approvedForm" class="form-horizontal"
                  ng-show="global.newState === 'hyväksytty'" role="form"
                  data-ng-submit="addApprovedState(approvedForm.$valid)" novalidate>

                  <div class="form-group">
                    <label class="col-md-2 control-label" for="board_meeting">
                        {{fieldNames["approved_board_meeting"]}}
                    </label>
                    <div class="col-md-4">
                        <input id="board_meeting" name="board_meeting"
                               data-ng-model="project.approved.board_meeting"
                               class="form-control"
                               placeholder="Hallituksen kokous">
                    </div>
                    <label for="board_notified_date" class="col-md-1 control-label">
                        {{fieldNames["approved_board_notified"]}}
                    </label>

                    <div class="col-md-4" ng-class="{'has-error': approvedForm.board_notified_date.$invalid}">
                        <div class="input-group">
                            <input  name="board_notified_date"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="board_notified_date"
                                    id="board_notified_date"
                                    is-open="boardnotifieddate.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats">
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(boardnotifieddate);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <div ng-show="approvedForm.board_notified_date.$invalid" class="col-md-5 has-error">
                        <p class="help-block">Valitse päivä</p>
                    </div>
                </div>

                <div class="form-group col-md-12">
                    <label class="col-md-2 control-label">
                        {{fieldNames["approved_themes"]}}
                    </label>
                    <div class="col-md-10">
                        <div ng-repeat="theme in themes" class="col-md-12">
                            <input type="checkbox" name="selectedThemes[]"
                                   value="{{theme}}"
                                   ng-checked="themeSelection.indexOf(theme) > -1"
                                   ng-click="toggleThemeSelection(theme)">
                            {{theme}}
                        </div>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="themes_disambiguation"
                           class="col-md-2 control-label">
                        Oik. fokus; Tarkennus
                    </label>
                    <div class="col-md-10">
                        <input id="themes_disambiguation"
                               name="themes_disambiguation"
                               data-ng-model="project.approved.themes_disambiguation"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label class="col-md-2 control-label" for="decision">
                        {{fieldNames["approved_decision"]}}
                    </label>
                    <div class="col-md-10">
                        <textarea id="decision" name="decision"
                                  data-ng-model="project.approved.decision"
                                  class="form-control" placeholder="Päätös">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="granted_sum_eur" class="col-md-2 control-label">
                        {{fieldNames["approved_granted_sum_eur"]}}
                    </label>
                    <div class="col-md-2"
                         ng-class="{'has-error': approvedForm.granted_sum_eur.$invalid}">
                        <input name="granted_sum_eur" type="number"
                               class="form-control"
                               data-ng-model="project.approved.granted_sum_eur"
                               id="granted_sum_eur" placeholder="0" min="0">
                        <div ng-show="approvedForm.granted_sum_eur.$invalid"
                             class="help-block">
                            <p ng-show="approvedForm.granted_sum_eur.$error.number">
                                Summan täytyy olla numero
                            </p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <!--{{fieldNames["approved_approved_date"]}}-->
                    <label for="approved_date" class="col-md-2 control-label">
                        Hyväksymispvm
                    </label>

                    <div class="col-md-4" ng-class="{'has-error': approvedForm.approved_date.$invalid}">
                        <div class="input-group">
                            <input  name="approved_date"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="approved_date"
                                    id="approved_date"
                                    is-open="approveddate.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats"></input>
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(approveddate);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <div ng-show="approvedForm.approved_date.$invalid" class="has-error">
                            <p class="help-block">Valitse päivä</p>
                        </div>
                    </div>

                    <label for="approved_by" class="col-md-1 control-label">
                        Hyväksyjä
                    </label>
                    <div class="col-md-4" ng-class="{'has-error': approvedForm.approved_by.$invalid}">
                        <select id="approved_by"
                                name="approved_by"
                                data-ng-model="project.approved.approved_by"
                                ng-options="authority for authority in authorities"
                                class='form-control' required>
                                <option disabled selected value> -- Valitse hyväksyjä -- </option>
                        </select>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="approved-button" type="submit" class="btn btn-primary"
                            ng-disabled="approvedForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!-- Hylätty -->
            <form name="rejectedForm" class="form-horizontal"
                  ng-show="global.newState === 'hylätty'" role="form"
                  data-ng-submit="addRejectedState(rejectedForm.$valid)" novalidate>

                <div class="form-group">
                    <label class="col-md-2">{{fieldNames["rejected_rejection_categories"]}}</label>
                    <div class="col-md-7">
                        <div id="rejSelection" data-ng-repeat="rej in addedRejections">
                            <select name="rejSelect" id="rejSelect"
                                    class="form-control"
                                    data-ng-model="rej.rejection"
                                    ng-options="rejCat for rejCat in rejCategories">
                                    <option disabled selected value> -- Valitse syy -- </option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12" style="margin-top: 1em">
                        <a id="remRej" class="btn btn-sm btn-default" href=""
                            ng-click="removeRejection();">
                            <span class="glyphicon glyphicon-minus">
                            </span>&nbsp;Poista viimeinen
                        </a>
                        <a id="addRej" class="btn btn-sm btn-default" href=""
                            ng-click="addRejection();">
                            <span class="glyphicon glyphicon-plus">
                            </span>&nbsp;Lisää
                        </a>
                    </div>
                </div>
                <hr>
                <div class="form-group">
                    <label for="comments" class="col-md-2">Kommentit</label>
                    <div class="col-md-10">
                        <textarea name="comments" type="text" class="form-control"
                                  data-ng-model="project.rejected.rejection_comments"
                                  id="comments"
                                  placeholder="Kommentit hylkäysperusteille">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="rejected-button" type="submit" class="btn btn-primary"
                            ng-disabled="rejectedForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!--Allekirjoitettu-->
            <form   name="signedForm" class="form-horizontal"
                    ng-show="global.newState === 'allekirjoitettu'"  role="form"
                    data-ng-submit="addSignedState(signedForm.$valid)" novalidate>
                <div class="form-group">
                    <label for="signed_by" class="col-md-2 control-label">Allekirjoittaja</label>
                    <div class="col-md-3" ng-class="{'has-error': signedForm.signed_by.$invalid}">
                        <input  name="signed_by" type="text" class="form-control"
                                data-ng-model="project.signed.signed_by" id="signed_by"
                                placeholder="Allekirjoittajan nimi" required>
                    </div>
                    <label for="signedDate" class="col-md-1 control-label">Päivämäärä</label>
                    <div class="col-md-4" ng-class="{'has-error': signedForm.signedDate.$invalid}">
                        <div class="input-group">
                            <input  name="signedDate"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="signed_date"
                                    id="signedDate"
                                    is-open="signeddate.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats">
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(signeddate);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <div ng-show="signedForm.signedDate.$invalid" class="has-error">
                            <p class="help-block">Valitse päivä</p>
                        </div>
                    </div>
                </div>
                <hr>
                <p><strong>Suunnitellut maksut</strong> myönnetylle avustukselle {{ project.approved.granted_sum_eur | currency : "EUR"}}</p>
                <div id="plPayments">
                    <div name="plannedPaymentSelection"
                        id="plannedPaymentSelection"
                        data-ng-repeat="plannedPayment in plannedPayments">

                        <div class="form-group">
                            <label class="col-md-1 control-label">
                                Päivämäärä
                            </label>

                            <div class="col-md-4" ng-class="{'has-error': signedForm.signed_date_$index.$invalid}">
                                <div class="input-group">
                                    <input  name="signed_date_$index"
                                            type="text"
                                            class="form-control"
                                            uib-datepicker-popup="d. MMMM yyyy"
                                            data-ng-model="plannedPayments[$index].date"
                                            id="signed_date_$index"
                                            is-open="plannedPayment.picker.opened"
                                            datepicker-options="dateOptions"
                                            ng-required="true"
                                            close-text="Sulje"
                                            clear-text="Tyhjennä"
                                            current-text="Tänään"
                                            alt-input-formats="altInputFormats">
                                    <span class="input-group-btn">
                                        <button type="button"
                                                class="btn btn-default"
                                                ng-click="openDatePicker(plannedPayment.picker);">
                                            <i class="glyphicon glyphicon-calendar"></i>
                                        </button>
                                    </span>
                                </div>
                                <div ng-show="signedForm.plannedPayments[$index].date.$invalid" class="has-error">
                                    <p class="help-block">Valitse päivä</p>
                                </div>
                            </div>

                            <label for="plannedSumEUR"
                                class="col-md-2 control-label">
                                Maksu (EUR)
                            </label>
                            <div class="col-md-2">
                                <input name="plannedSumEUR" type="number"
                                    class="form-control"
                                    data-ng-model="plannedPayments[$index].sum_eur"
                                    id="plannedSumEUR"
                                    placeholder="Summa (EUR)" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12">
                            <a ng-click="removePlannedPayment();" href=""
                            class="btn btn-sm btn-default">
                                <span class="glyphicon glyphicon-minus">
                                </span>&nbsp;Poista viimeinen
                            </a>
                            <a id="add-btn" class="btn btn-sm btn-default" href=""
                            ng-click="addPlannedPayment();">
                                <span class="glyphicon glyphicon-plus">
                                </span>&nbsp;Lisää
                            </a>
                        </div>
                    </div>
                </div>
                <hr>
                <label for="reportDeadlines">Raporttien eräpäivät</label>
                <div    name="reportDeadlines" id="reportDeadlines"
                        data-ng-repeat="deadline in deadlines">
                    <div class="form-group">
                        <label for="dlRep" class="col-md-1 control-label">
                                Raportti
                        </label>
                        <div class="col-md-3">
                            <input  name="dlRep" type="text" class="form-control"
                                    data-ng-model="deadlines[$index].report"
                                    id="dlRep" placeholder="Raportti">
                        </div>
                        <label for="dlDay" class="col-md-1 control-label">
                            Eräpäivä
                        </label>

                        <div class="col-md-4" ng-class="{'has-error': signedForm.deadline_$index.$invalid}">
                            <div class="input-group">
                                <input  name="deadline_$index"
                                        type="text"
                                        class="form-control"
                                        uib-datepicker-popup="d. MMMM yyyy"
                                        data-ng-model="deadlines[$index].date"
                                        id="signed_date_$index"
                                        is-open="deadline.picker.opened"
                                        datepicker-options="dateOptions"
                                        ng-required="true"
                                        close-text="Sulje"
                                        clear-text="Tyhjennä"
                                        current-text="Tänään"
                                        alt-input-formats="altInputFormats">
                                <span class="input-group-btn">
                                    <button type="button"
                                            class="btn btn-default"
                                            ng-click="openDatePicker(deadline.picker);">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                            </div>
                            <div ng-show="signedForm.deadlines[$index].date.$invalid" class="has-error">
                                <p class="help-block">Valitse päivä</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12">
                        <a class="btn btn-sm btn-default" href=""
                            ng-click="removeDeadline();">
                            <span class="glyphicon glyphicon-minus">
                            </span>&nbsp;Poista viimeinen
                        </a>
                        <a id="add-btn2" class="btn btn-sm btn-default" href=""
                            ng-click="addDeadline();">
                            <span class="glyphicon glyphicon-plus">
                            </span>&nbsp;Lisää
                        </a>
                    </div>
                </div>
                <div class="form-group" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="signed-button" type="submit" class="btn btn-primary"
                            ng-disabled="signedForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!--    Väliraportti-->
            <form name="intReportForm" class="form-horizontal"
                  ng-show="global.newState === 'väliraportti'" role="form"
                  data-ng-submit="addIntReportState(intReportForm.$valid)"
                  novalidate>
                <div class="form-group">
                    <label for="payments" class="col-md-2">Maksatukset</label>
                    <p class="col-md-12">Maksettu:</p>
                    <div class="form-group col-md-12"
                         ng-repeat="payment in project.payments">
                        <div class="col-md-4">
                            {{ payment.sum_eur | currency : "EUR" }} /
                            {{ payment.payment_date | date : 'dd.MM.yyyy' }}
                        </div>
                    </div>
                </div>
                <label class="col-md-12">
                    {{fieldNames["project_goal"]}}
                </label>
                <div class="form-group col-md-12">
                    <div class="col-md-6" style="text-align: justify">
                        <p ng-bind-html="handleEmphasis(project.project_goal)"></p>
                    </div>
                    <div class="col-md-6">
                        <textarea name="objComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.objectives"
                                  id="objComments"
                                  rows="10" cols="50">
                        </textarea>
                    </div>
                </div>
                <label class="col-md-12">
                    {{fieldNames["methods"]}}
                </label>
                <div class="form-group col-md-12" ng-repeat="method in project.methods">
                    <div class="col-md-6" style="text-align: justify">
                        <p><em>{{method.name}}</em> ({{method.level}})</p>
                        <p ng-bind-html="handleEmphasis(method.comment)"></p>
                    </div>
                    <div class="col-md-6">
                        <p>&nbsp;</p>
                        <textarea name="intRMethods" type="text"
                                  class="form-control"
                                  data-ng-model="addedMethods[(project.methods).indexOf(method)]"
                                  rows="10" cols="50"
                                  id="intRMethods">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="communication" class="col-md-4">
                        {{fieldNames["intreport_communication"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="communication" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.communication"
                                  id="communication">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="budget" class="col-md-4">
                        {{fieldNames["intreport_budget"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="budget" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.budget"
                                  id="budget">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="evaluation" class="col-md-4">
                        {{fieldNames["intreport_evaluation"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="evaluation" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.evaluation"
                                  id="evaluation">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="overallKios" class="col-md-2">
                        {{fieldNames["intreport_overall_rating_kios"]}}
                    </label>
                    <div class="col-md-10">
                        <textarea name="overallKios" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.overall_rating_kios">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="comments" class="col-md-2">Päätös</label>
                    <div class="col-md-10">
                        <textarea name="intRComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.intermediary_report.comments"
                                  id="intRcomments"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="intRDateAppr" class="col-md-2">Hyväksymispvm</label>

                    <div class="col-md-4" ng-class="{'has-error': intReportForm.intRDateAppr.$invalid}">
                        <div class="input-group">
                            <input  name="intRDateAppr"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="intr_approved_date"
                                    id="intRDateAppr"
                                    is-open="intrdateappr.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats">
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(intrdateappr);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <div ng-show="intReportForm.intRDateAppr.$invalid" class="col-md-5 has-error">
                        <p class="help-block">Valitse päivä</p>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="int-report-button" type="submit" class="btn btn-primary"
                            ng-disabled="intReportForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!--   Loppuraportti-->
            <form name="endReportForm" class="form-horizontal col-md-12"
                  ng-show="global.newState === 'loppuraportti'" role="form"
                  data-ng-submit="addEndReportState(endReportForm)" novalidate>
                <div class="form-group">
                    <label class="col-md-4" for="end_board_meeting">
                        {{fieldNames["end_report_board_meeting"]}}
                    </label>
                    <div class="col-md-4">
                        <input id="end_board_meeting" name="end_board_meeting"
                               data-ng-model="project.end_report.board_meeting"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="end_budget" class="col-md-4">
                        {{fieldNames["end_report_budget"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="end_budget" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.budget"
                                  id="end_budget"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="audit_date" class="col-md-4">Tilintarkastuspvm</label>

                    <div class="col-md-4" ng-class="{'has-error': endReportForm.audit_date.$invalid}">
                        <div class="input-group">
                            <input  name="audit_date"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="audit_date"
                                    id="audit_date"
                                    is-open="auditdate.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats">
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(auditdate);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <div ng-show="endReportForm.audit_date.$invalid" class="col-md-5 has-error">
                        <p class="help-block">Valitse päivä</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="audit_review" class="col-md-4">
                        Tilintarkastuksen Arvio
                    </label>
                    <div class="col-md-6">
                        <textarea name="audit_review" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.audit.review"
                                  id="audit_review"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <label class="col-md-12">
                    {{fieldNames["project_goal"]}}
                </label>
                <div class="form-group col-md-12">
                    <div class="col-md-6" style="text-align: justify">
                        <p ng-bind-html="handleEmphasis(project.project_goal)">
                        </p>
                    </div>
                    <div class="col-md-6">
                        <textarea name="objectivesComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.objective"
                                  id="objectivesComments" rows="10" cols="50">
                        </textarea>
                    </div>
                </div>
                <label class="col-md-12"
                       data-ng-show="project.methods && project.methods.length > 0">
                    {{fieldNames["methods"]}}
                </label>
                <div class="form-group col-md-12"
                     ng-repeat="method in project.methods">
                    <div class="col-md-6" style="text-align: justify">
                        <p><em>{{method.name}}</em> ({{method.level}})</p>
                        <p ng-bind-html="handleEmphasis(method.comment)"></p>
                    </div>
                    <div class="col-md-6">
                        <p>&nbsp;</p>
                        <textarea name="er_methods" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.methods[project.methods.indexOf(method)]"
                                  rows="10" cols="50"
                                  id="er_methods">
                        </textarea>
                    </div>
                </div>
                <label class="col-md-12">
                    {{fieldNames["end_report_planned_results"]}}
                </label>
                <div class="form-group col-md-12">
                    <div class="col-md-6" style="text-align: justify">
                        <p ng-bind-html="handleEmphasis(project.indicators)"></p>
                    </div>
                    <div class="col-md-6">
                        <textarea name="plannedResultsComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.planned_results"
                                  id="plannedResultsComments" rows="10" cols="50">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <label for="indicatorsComments" class="col-md-4">
                        {{fieldNames["end_report_indicators"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="indicatorsComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.indicators"
                                  id="indicatorsComments">
                        </textarea>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <div class="col-md-3">
                        <div class="col-md-6">
                            <label for="direct_beneficiaries">
                                {{fieldNames["end_report_direct_beneficiaries"]}}
                                (arvio)
                            </label>
                        </div>
                        <div class="col-md-6">
                            <input id="direct_beneficiaries" name="direct_beneficiaries"
                                   class="form-control"
                                   data-ng-model="project.end_report.direct_beneficiaries">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="col-md-6">
                            <label for="direct_beneficiaries">
                                {{fieldNames["end_report_indirect_beneficiaries"]}}
                                (arvio)
                            </label>
                        </div>
                        <div class="col-md-6">
                            <input id="indirect_beneficiaries"
                                   name="indirect_beneficiaries" class="form-control"
                                   data-ng-model="project.end_report.indirect_beneficiaries">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="grade" class="col-md-4">
                            {{fieldNames["end_report_grade"]}}
                        </label>
                        <div    class="col-md-8"
                                ng-class="{'has-error': endReportForm.grade.$invalid}">
                            <select name="grade" id="grade"
                                    data-ng-model="project.end_report.grade"
                                    ng-options="key as value for (key , value) in grades"
                                    class="form-control"
                                    required>
                                    <option disabled selected value> -- Valitse arvio -- </option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gen_review" class="col-md-2">
                        {{fieldNames["end_report_general_review"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="gen_review" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.general_review"
                                  id="gen_review"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="proposition" class="col-md-2">
                        {{fieldNames["end_report_proposition"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="proposition" type="text"
                                  class="form-control"
                                  data-ng-model="project.end_report.proposition"
                                  id="proposition"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="conclusion" class="col-md-2">
                        {{fieldNames["end_report_conclusion"]}}
                    </label>
                    <div class="col-md-8">
                        <textarea name="conclusion" type="text" class="form-control"
                                  data-ng-model="project.end_report.conclusion"
                                  id="conclusion"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <!--{{fieldNames["end_report_approved_date"]}}-->
                    <label for="er_approved_date" class="col-md-2">Hyväksymispvm</label>

                    <div class="col-md-4" ng-class="{'has-error': endReportForm.er_approved_date.$invalid}">
                        <div class="input-group">
                            <input  name="er_approved_date"
                                    type="text"
                                    class="form-control"
                                    uib-datepicker-popup="d. MMMM yyyy"
                                    data-ng-model="er_approved_date"
                                    id="er_approved_date"
                                    is-open="endrdateappr.opened"
                                    datepicker-options="dateOptions"
                                    ng-required="true"
                                    close-text="Sulje"
                                    clear-text="Tyhjennä"
                                    current-text="Tänään"
                                    alt-input-formats="altInputFormats">
                            <span class="input-group-btn">
                                <button type="button"
                                        class="btn btn-default"
                                        ng-click="openDatePicker(endrdateappr);">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <div ng-show="endReportForm.er_approved_date.$invalid" class="col-md-5 has-error">
                        <p class="help-block">Valitse päivä</p>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="end-report-button" type="submit" class="btn btn-primary"
                            ng-disabled="endReportForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
            <!--Päättynyt-->
            <form name="endedForm" class="form-horizontal"
                  ng-show="global.newState === 'päättynyt'" role="form"
                  data-ng-submit="addEndedState(endedForm.$valid)" novalidate>
                <div class="form-group">
                    <div>
                        <label for="notifiedDay" class="col-md-2">
                            {{fieldNames["ended_board_notified"]}}
                        </label>

                        <div class="col-md-3" ng-class="{'has-error': endedForm.endNotifiedDay.$invalid}">
                            <div class="input-group">
                                <input  name="endNotifiedDay"
                                        type="text"
                                        class="form-control"
                                        uib-datepicker-popup="d. MMMM yyyy"
                                        data-ng-model="end_notified_date"
                                        id="endNotifiedDay"
                                        is-open="endnofifieddate.opened"
                                        datepicker-options="dateOptions"
                                        ng-required="true"
                                        close-text="Sulje"
                                        clear-text="Tyhjennä"
                                        current-text="Tänään"
                                        alt-input-formats="altInputFormats">
                                <span class="input-group-btn">
                                    <button type="button"
                                            class="btn btn-default"
                                            ng-click="openDatePicker(endnofifieddate);">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                            </div>
                            <div ng-show="endedForm.endNotifiedDay.$invalid" class="has-error">
                                <p class="help-block">Valitse päivä</p>
                            </div>
                        </div>
                    </div>
                    <label for="comments" class="col-md-1">
                        {{fieldNames["ended_other_comments"]}}
                    </label>
                    <div class="col-md-5">
                        <textarea name="endComments" type="text"
                                  class="form-control"
                                  data-ng-model="project.ended.other_comments"
                                  id="comments"
                                  rows="5">
                        </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div>
                        <label for="endDay" class="col-md-2 control-label">
                            Päättymispvm
                            <!--{{fieldNames["ended_end_date"]}}-->
                        </label>
                        <div class="col-md-3" ng-class="{'has-error': endedForm.endDate.$invalid}">
                            <div class="input-group">
                                <input  name="endDate"
                                        type="text"
                                        class="form-control"
                                        uib-datepicker-popup="d. MMMM yyyy"
                                        data-ng-model="end_date"
                                        id="endDate"
                                        is-open="enddate.opened"
                                        datepicker-options="dateOptions"
                                        ng-required="true"
                                        close-text="Sulje"
                                        clear-text="Tyhjennä"
                                        current-text="Tänään"
                                        alt-input-formats="altInputFormats">
                                <span class="input-group-btn">
                                    <button type="button"
                                            class="btn btn-default"
                                            ng-click="openDatePicker(enddate);">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                            </div>
                            <div ng-show="endedForm.endDate.$invalid" class="has-error">
                                <p class="help-block">Valitse päivä</p>
                            </div>
                        </div>
                    </div>
                    <label for="approved_by" class="col-md-1">
                        {{fieldNames["ended_approved_by"]}}
                    </label>
                    <div class="col-md-5">
                        <select id="approved_by"
                                data-ng-model="project.ended.approved_by"
                                class='form-control'>
                            <option value="toiminnanjohtaja">
                                Toiminnanjohtaja
                            </option>
                            <option value="hallitus">Hallitus</option>
                        </select>
                    </div>
                </div>
                <div class="form-group col-md-12" style="text-align: center">
                    <hr>
                    <a href="/projects/{{project._id}}" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove"></span>&nbsp;
                        Peru
                    </a>
                    <button id="end-button" type="submit" class="btn btn-primary"
                            ng-disabled="endedForm.$invalid">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
        </div>
    </article>
</section>
