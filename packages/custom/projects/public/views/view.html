
<section data-ng-controller="ProjectsController" data-ng-init="findOne()">

    <h2 id="projtitle"><span class="name">{{project.project_ref}}: {{project.title}}</span>
        <span>
            <!--                Confirm action here-->

            <a class="btn-lg" id="delete" data-ng-click="confirm(project);">
                <i class="glyphicon glyphicon-trash"></i>
            </a>
        </span>
    </h2>

    <h3>Koordinaattori: <a href="">{{project.coordinator}}</a>
        <span class="tila">{{project.state}}</span></h3>

    <hr>

    <article class="proj-body" ng-show="project.approved">
        <h5>Teemat </h5>
        <button type="button" data-ng-model="project.approved.themes" data-ng-repeat="theme in project.approved.themes" disabled>
            <span class="glyphicon glyphicon-tag">
            </span> {{theme}}
        </button><br>
    </article>


    <article ng-show="state.next.length !== 0 && project.state !== 'hylätty' && project.state !== 'päättynyt'" class="tila ng-hide" data-ng-init="findState()">
        <form name="stateForm" class="states" data-ng-submit="changeState(project.changeTo);">
            <label for="stateSelect">Siirry tilaan: </label>
            <select id="stateSelect" data-ng-model="project.changeTo">
                <option data-ng-repeat="next_state in state.next_states" value="{{next_state}}">{{next_state}}</option>
            </select>
            <button type="submit" class="btn-xs">
                <span class="glyphicon glyphicon-arrow-right"></span>
            </button>
        </form>

    </article>

    <article class="proj-box-left">

        <article class="proj-left">
            <h4 class="proj-header">Kuvaus</h4>
            <span class="proj-body">
                {{project.description}}
            </span>
        </article>

        <article class="proj-div">
            <h4 class="proj-header">Järjestö</h4>
            <section class="proj-body">
                <p>Nimi: <a data-ng-href="/organisations/{{project.organisation._id}}">{{project.organisation.name}}</a></p>
                <p>Edustaja: <a href="">{{project.organisation.representative}}</a>
                <h5>Osoite:</h5>
                <p>{{project.organisation.address.street}}<br>
                    {{project.organisation.address.postal_code}} {{project.organisation.address.city}}<br>
                    {{project.organisation.address.country}}</p>
                <p>Puhelinnumero: {{project.organisation.tel}}</p>
                <p>Sähköposti: {{project.organisation.email}}</p>
                <p>Websivut: {{project.organisation.website}}</p>
            </section>
        </article>

        <article class="proj-div">
            <h4 class="proj-header">Hanketiedot</h4>
            <section class="proj-body">

                <p>Vaikutusalue: {{project.region}}</p>
                <p> DAC: {{project.dac}}
                <p>Tila: {{project.status}}</p>

                <p>Kirjattu: {{project.reg_date| date:'dd.MM.yyyy'}}</p>
                <p ng-show="project.funding.granted_curr_eur" class="ng-hide">Myönnetty: {{project.funding.granted_curr_eur}} EUR ({{project.funding.granted_curr_local}} local)</p>
                <p ng-show="!project.funding.granted_curr_eur" class="ng-hide">Haettu: {{project.funding.applied_curr_eur}} EUR ({{project.funding.applied_curr_local}} local)</p>
                <p>Kesto: {{project.duration_months}} kk</p>
            </section>
        </article>

    </article>

    <article class="proj-box-right">
        <article class="proj-right">

            <button class="btn" onclick="toggleCollapse('visibilityAppinfo')">Hakemustiedot</button>

            <article id="visibilityAppinfo">

                <article class="proj">
                    <h4 class="proj-header">Hankkeen taustat</h4>
                    <span class="proj-body">
                        {{project.background}}
                    </span>
                </article>


                <article class="proj">
                    <h4 class="proj-header">Hankkeen tavoite</h4>
                    <span class="proj-body">
                        {{project.project_goal}}
                    </span>
                </article>


                <article class="proj">
                    <h4 class="proj-header">Hyödynsaajat ja vastuunkantajat</h4>
                    <span class="proj-body">
                        {{project.beneficiaries}}
                    </span>
                </article>

                <article class="proj">
                    <h4 class="proj-header">Gender analyysi</h4>
                    <span class="proj-body">
                        {{project.gender_aspect}}
                    </span>
                </article>

                <article class="proj">
                    <h4 class="proj-header">Riskit</h4>
                    <span class="proj-body">
                        {{project.sustainability_risks}}
                    </span>
                </article>

                <article class="proj">
                    <h4 class="proj-header">Evaluointi</h4>
                    <span class="proj-body">
                        {{project.reporting_evaluation}}
                    </span>
                </article>

                <article class="proj">
                    <h4 class="proj-header">Muut haut</h4>
                    <span class="proj-body">
                        {{project.other_donors_proposed}}
                    </span>
                </article>
            </article>
        </article>

        <article class="proj-right">

            <button class="btn" onclick="toggleCollapse('visibilityPayments')">Maksatus</button>
            <article id="visibilityPayments">

                <article class="proj">
                    <p class="proj-header">Myönnetty</p>
                    <section class="proj-body">
                        <p>Summa: {{project.funding.granted_curr_eur}} EUR ({{project.funding.granted_curr_local}} local) 12.10.2014</p>
                        <p>Lisärahoitus: 1000 euroa (10 000 paikallista) 5.7.2014</p>
                    </section>
                    <br>
                    <section class="proj-body">
                        <p class="proj-header">Maksettu</p>
                        <p>1. Erä: 4000 euroa (10 000 paikallista) 7.1.2015</p>
                        <p>2. Erä: 4000 euroa (10 000 paikallista) 7.6.2015</p>
                        <br>
                        <p>Maksettu yhteensä: 8000 euroa (10 000 paikallista) </p>
                        <p>Jäljellä: 3000 euroa (10 000 paikallista) </p>
                    </section>
                </article>
            </article>
        </article>

        <article class="proj-right">
            <button class="btn" onclick="toggleCollapse('visibilityAttachments')">Liitteet</button>

            <article id="visibilityAttachments">
                <h4 class="proj-header">Liitteet</h4>
                <section class="proj-body">
                    <p><a href="">Hakemus</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">Budjetti</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">1. väliraportti</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">2. väliraportti</a> - ODOTTAA</p>
                    <p><a href="">Suosituskirje A</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">Suosituskirje B</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">Evaluointi</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">Esitys 1</a> - Hyväksytty 1.1.2014</p>
                    <p><a href="">Esitys 2</a> - ODOTTAA</p>
                    <p><a href="">Sopimus</a> - Hyväksytty 1.1.2014</p>
                </section>

            </article>
        </article>


    </article>

    <hr>
    <article>
        <h4 class="proj-header">Aikataulu</h4>
        <section ng-show="project.in_review._id" class="proj-body">
            <p><b>**Rekisteröity käsittelyyn</b>:&nbsp&nbsp{{project.in_review.date| date:'dd.MM.yyyy'}}&nbsp&nbsp
            <button class="btn small-btn" onclick="toggleCollapse('visibilityReviewinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilityReviewinfo">
                <h5>Muokkaaja:</h5>
                <p>{{project.in_review.user}}, {{project.in_review.date| date:'dd.MM.yyyy, HH:mm'}}</p>
                <h5>Kommentit: </h5>
                <p>{{project.in_review.comments}}</p>
            </span>

        </section>
        <section ng-show="project.approved._id" class="proj-body">
            <p><b>**Rekisteröity hyväksytyksi</b>: {{project.approved.date| date:'dd.MM.yyyy'}}
            <button class="btn small-btn" onclick="toggleCollapse('visibilityApprovedinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilityApprovedinfo">
                <h5>Muokkaaja:</h5>
                <p>{{project.approved.user}}, {{project.approved.date| date:'dd.MM.yyyy, HH:mm'}}</p>
                <h5>Hyväksyjä:</h5>
                <p>{{project.approved.approved_by}}</p>
                <h5>Hyväksymis pvm:</h5>
                <p>{{project.approved.approved_date}}</p>
                <h5>Hallitukselle tiedoksi:</h5>
                <p>{{project.approved.board_notified}}</p>
                <h5>Hyväksytty summa:</h5>
                <p>{{project.approved.granted_sum.granted_curr_eur}} € ({{project.approved.granted_sum.granted_curr_local}} paikallista valuuttaa)</p>
                <h5>Teemat:</h5>
                <ul>
                    <li data-ng-repeat="theme in project.approved.themes">{{theme}}</li>
                </ul>
                <h5>Toimintatavat:</h5>
                <ul>
                    <li data-ng-repeat="method in project.approved.methods">{{method.name}},
                        <i>taso:</i> {{method.level}}
                    </li>
                </ul>
            </span>

        </section>
        <section ng-show="project.rejected._id" class="proj-body">
            <p><b>**Rekisteröity hylätyksi</b>:&nbsp&nbsp{{project.rejected.date| date:'dd.MM.yyyy'}}&nbsp&nbsp
            <button class="btn small-btn" onclick="toggleCollapse('visibilityRejectedinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilityRejectedinfo">
                <h5>Muokkaaja:</h5>
                <p>{{project.rejected.user}}, {{project.rejected.date| date:'dd.MM.yyyy, HH:mm'}}</p>
                <h5>Hylkäyssyyt:</h5>
                <ul>
                  <li ng-repeat="rej in project.rejected.rejection_categories">{{rej}} </li>
                </ul>
                <h5>Kommentit: </h5>
                <p>{{project.rejected.rejection_comments}}</p>
            </span>

        </section>

        <section ng-show="project.signed._id" class="proj-body">
            <p><b>**Rekisteröity allekirjoitetuksi</b>:&nbsp&nbsp{{project.signed.date| date:'dd.MM.yyyy'}}&nbsp&nbsp
            <button class="btn small-btn" onclick="toggleCollapse('visibilitySignedinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilitySignedinfo">
                <h5>Muokkaaja:</h5>
                <p>{{project.signed.user}}, {{project.signed.date| date:'dd.MM.yyyy, HH:mm'}}</p>
                <h5>Allekirjoitettu:</h5>
                <p><{{project.signed.signed_by}}, <i>päivämäärä</i>: {{project.signed.signed_date}}</p>
            </span>

        </section>

        <section ng-show="project.end_report._id" class="proj-body">
            <p><b>**Loppuraportti rekisteröity</b>:&nbsp&nbsp{{project.end_report.date| date:'dd.MM.yyyy'}}&nbsp&nbsp
            <button class="btn small-btn" onclick="toggleCollapse('visibilityEndreportinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilityEndreportinfo">
                <h5>Muokkaaja:</h5>
                <p>{{project.end_report.user}}, {{project.end_report.date| date:'dd.MM.yyyy, HH:mm'}}</p>
                <p ng-show="project.end_report.processed === true">Loppuraportti käsitelty</p>
                <h5>Tilintarkastus</h5>
                <p>Tilintarkastus suoritettu {{project.end_report.audit.date}}</p>
                <p>{{project.end_report.audit.review}}</p>
                <h5>Kommentit</h5>
                <p>{{project.end_report.comments}}</p>
                <h5>Teemat</h5>
                <ul>
                  <li ng-repeat="theme in project.approved.themes">
                     <i>{{theme}}</i><br>
                    {{project.end_report.themes[project.approved.themes.indexOf(theme)]}}
                  </li>
                </ul>
                <h5>Metodit</h5>
                <ul>
                  <li ng-repeat="method in project.approved.methods">
                     <i>{{method.name}}</i>, taso: <i>{{method.level}}</i><br>
                    {{project.end_report.methods[project.approved.methods.indexOf(method)]}}
                  </li>
                </ul>
                <h5>Tavoitteet</h5>
                <ul>
                  <li ng-repeat="objective in project.intermediary_report.objectives">{{objective}}</li>
                </ul>
            </span>

        </section>
        <section ng-show="project.ended._id" class="proj-body">
            <p><b>**Rekisteröity päätetyksi</b>:&nbsp&nbsp{{project.ended.end_date}}&nbsp&nbsp
            <button class="btn small-btn" onclick="toggleCollapse('visibilityEndedinfo')">Tiedot</button></p>
            <span class="proj-left" id="visibilityEndedinfo">
                <h5>Tiedot lisäsi:</h5>
                <p>{{project.ended.user}}, {{project.ended.date| date:'dd.MM.yyyy, HH:mm'}}</p>

                <h5>Hyväksyjä:</h5>
                <p>{{project.ended.approved_by}}</p>
                <h5>Hallitukselle tiedotettu (pvm):</h5>
                <p>{{project.ended.board_notified}}</p>
                <br>
                <h5>Muut päättämiseen liittyvät kommentit:</h5>
                <p>{{project.ended.other_comments}}</p>
            </span>

        </section>
    </article>
