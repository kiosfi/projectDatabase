<article data-ng-controller="ProjectsController" data-ng-init="findOne()">
    <link rel="stylesheet" type="text/css" href="/theme/assets/css/twoPart.css">
    <div id="header">
        <h1 id="projtitle">
            {{project.project_ref}}: {{project.title}}
        </h1>
        <hr>
    </div>
    <ul id="menu" class="nav nav-list left-part">
        <li>
            <label><a href="#functions">Toiminnot</a></label>
            <ul>
                <li ng-show="state.next.length !== 0 &&
                            project.state !== 'hylätty' &&
                            project.state !== 'päättynyt'">
                    <a href="#stateTransition">
                        Tilasiirtymä
                    </a>
                </li>
                <li>
                    <a ng-href="/projects/{{project._id}}/edit">Muokkaus</a>
                </li>
                <li><a href="#addAppendix">Liitteen lisäys</a></li>
                <li ng-show="project.signed.date">
                    <a href="#addPayment">
                        Maksun lisäys
                    </a>
                </li>
                <li>
                    <a data-ng-click="confirmProjectDeletion(project);" href="">
                        Poisto
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <label><a href="#header">Hanke</a></label>
            <ul>
                <li><a href="#summary">Yhteenveto</a></li>
                <li><a href="#description">Kuvaus</a></li>
                <li><a href="#details">Lisätiedot</a></li>
                <li ng-show="project.special_notes">
                    <a href="#special_notes">Erityishuomioita</a>
                </li>
            </ul>
        </li>
        <!--        <li>
                    <label><a href="#organisation">Järjestö</a></label>
                </li>-->
        <li>
            <label><a href="#assessment">Arvio</a></label>
        </li>
        <li>
            <label><a href="#schedule">Aikataulu</a></label>
            <ul>
                <li ng-show="project.signed.intreport_deadlines.length > 0">
                    <a href="#schedule">Suunniteltu</a>
                </li>
                <li><a href="#reports">Toteutunut</a></li>
                <li>
                    <a href="#stateTransition"
                       ng-show="state.next.length !== 0 &&
                                   project.state !== 'hylätty' &&
                                   project.state !== 'päättynyt'">
                        Tilasiirtymä
                    </a>
                </li>
            </ul>
        </li>
        <li ng-show="project.approved.granted_sum_eur">
            <label><a href="#payments">Maksatus</a></label>
            <ul ng-show="project.signed.date">
                <li>
                    <a href="#addPayment">Maksun lisäys</a>
                </li>
            </ul>
        </li>
        <li>
            <label><a href="#checklist">Liitteet</a></label>
            <ul>
                <li><a href="#checklist">Vaaditut liitteet</a></li>
                <li ng-show="project.appendices.length > 0">
                    <a href="#appendices">Tallennetut liitteet</a>
                </li>
                <li>
                    <a href="#addAppendix">Liitteen lisäys</a>
                </li>
            </ul>
        </li>
        <li>
            <label><a href="#log">Muokkaukset</a></label>
        </li>
    </ul>
    <article id="functions" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideFunctions = !hideFunctions">
                    <span class="glyphicon"
                          ng-class="hideFunctions
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Toiminnot
                </span>
            </h4>
        </div>
        <section class="panel-body" style="text-align: center" ng-hide="hideFunctions">
            <big>
                <a ng-href="#stateTransition"
                   ng-show="state.next.length !== 0 &&
                               project.state !== 'hylätty' &&
                               project.state !== 'päättynyt'"
                   class="btn btn-default" style="margin-right: 1em">
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    Tilasiirtymä
                </a>
                <span class="btn btn-default disabled" style="margin-right: 1em"
                      ng-show="state.next.length === 0 ||
                                  project.state === 'hylätty' ||
                                  project.state === 'päättynyt'"
                                  title="Hankkeella ei ole enää laillisia tilasiirtymiä.">
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    Tilasiirtymä
                </span>
                <a id="edit" ng-href="/projects/{{project._id}}/edit"
                   class="btn btn-default" style="margin-right: 1em">
                    <span class="glyphicon glyphicon-edit"></span>
                    Muokkaus
                </a>
                <a ng-href="#addAppendix" class="btn btn-default"
                   style="margin-right: 1em">
                    <span class="glyphicon glyphicon-paperclip"></span>
                    Liitteen lisäys
                </a>
                <a ng-href="#addPayment" ng-show="project.signed.date"
                   class="btn btn-default" style="margin-right: 1em">
                    <span class="glyphicon glyphicon-eur"></span>
                    Maksun lisäys
                </a>
                <span ng-show="!project.signed.date"
                      class="btn btn-default disabled"
                      style="margin-right: 1em"
                      title="Hankkeen tulee olla allekirjoitettu ennen maksujen lisäämistä.">
                    <span class="glyphicon glyphicon-eur"></span>
                    Maksun lisäys
                </span>
                <a id="delete" data-ng-click="confirmProjectDeletion(project);"
                   href="" class="btn btn-danger" style="margin-right: 1em">
                    <span class="glyphicon glyphicon-trash"></span>
                    Poisto
                </a>
            </big>
        </section>
    </article>
    <article class="panel panel-primary" id="summary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideSummary = !hideSummary">
                    <span class="glyphicon"
                          ng-class="hideSummary
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Yhteenveto
                </span>
            </h4>
        </div>
        <div class="panel-body" ng-hide="hideSummary">
            <section style="padding-bottom: 1em">
                <h4>
                    <span class="col-md-1">{{fieldNames["state"]}}</span>
                    <span class="col-md-5">
                        {{project.state}}
                        <span ng-if="project.incomplete"> (keskeneräinen)</span>
                    </span>
                    <span class="col-md-2">{{fieldNames["coordinator"]}}</span>
                    <span class="col-md-4">{{project.coordinator}}</span>
                </h4>
            </section>
            <hr>
            <section style="padding-bottom: 1em">
                <section class="col-md-6">
                    <h4>Perustiedot</h4>
                    <section class="section">
                        <table class="summary-table">
                            <tr>
                                <th>
                                    {{fieldNames["security_level"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.security_level}}
                                </td>
                            </tr>
                            <tr ng-show="nonEmpty(project.country)">
                                <th>
                                    {{fieldNames["country"]}}
                                </th>
                                <td class="summary-td">{{project.country}}</td>
                            </tr>
                            <tr ng-show="nonEmpty(project.region)">
                                <th>
                                    {{fieldNames["region"]}}
                                </th>
                                <td class="summary-td">{{project.region}}</td>
                            </tr>
                            <tr ng-show="nonEmpty(project.dac)">
                                <th>
                                    {{fieldNames["dac"]}}
                                </th>
                                <td class="summary-td">{{project.dac}}</td>
                            </tr>
                            <tr ng-show="nonEmpty(project.state)">
                                <th>
                                    {{fieldNames["state"]}}
                                </th>
                                <td class="summary-td">{{project.state}}</td>
                            </tr>
                            <tr>
                                <th>
                                    {{fieldNames["reg_date"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.reg_date| date:'d.M.yyyy': '+0200'}}
                                </td>
                            </tr>
                            <tr ng-show="project.approved.granted_sum_eur">
                                <th>
                                    {{fieldNames["approved_granted_sum_eur"]}}
                                </th>
                                <td class="summary-td">
                                    {{numberToString(project.approved.granted_sum_eur)}}
                                </td>
                            </tr>
                            <tr ng-show="!project.approved.granted_sum.granted_curr_eur &&
                                                    project.funding.applied_curr_eur >= 0">
                                <th>
                                    {{fieldNames["funding_applied_curr_eur"]}}
                                </th>
                                <td class="summary-td">
                                    {{numberToString(project.funding.applied_curr_eur)}}
                                </td>
                            </tr>
                            <tr ng-show="!project.approved.granted_sum.granted_curr_eur &&
                                                    project.funding.applied_curr_local">
                                <th>
                                    {{fieldNames["funding_applied_curr_local"]}}
                                    ({{project.funding.curr_local_unit ?
                            project.funding.curr_local_unit : "paik. val."}})
                                </th>
                                <td class="summary-td">
                                    {{numberToString(project.funding.applied_curr_local)}}
                                </td>
                            </tr>
                            <tr ng-show="project.duration_months >= 0">
                                <th>
                                    {{fieldNames["duration_months"]}}
                                </th>
                                <td class="summary-td">{{project.duration_months}}</td>
                            </tr>
                        </table>
                    </section>
                </section>
                <section id="organisation" class="col-md-6">
                    <h4>{{fieldNames["organisation"]}}</h4>
                    <section class="section">
                        <table class="summary-table">
                            <tr ng-show="nonEmpty(project.organisation.name)">
                                <th>
                                    {{fieldNames["organisation_name"]}}
                                </th>
                                <td class="summary-td">
                                    <a data-ng-href="/organisations/{{project.organisation._id}}">
                                        {{project.organisation.name}}</a>
                                </td>
                            </tr>
                            <tr ng-show="nonEmpty(project.organisation.
                                                    representative.name)">
                                <th>
                                    {{fieldNames["organisation_representative"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.organisation.representative.name}}
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    {{fieldNames["organisation_address"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.organisation.address.street}}<br>
                                    {{project.organisation.address.postal_code}}
                                    {{project.organisation.address.city}}<br>
                                    {{project.organisation.address.country}}
                                </td>
                            </tr>
                            <tr ng-show="nonEmpty(project.organisation.tel)">
                                <th>
                                    {{fieldNames["organisation_tel"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.organisation.tel}}
                                </td>
                            </tr>
                            <tr ng-show="nonEmpty(project.organisation.email)">
                                <th>
                                    {{fieldNames["organisation_email"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.organisation.email}}
                                </td>
                            </tr>
                            <tr ng-show="nonEmpty(project.organisation.website)">
                                <th>
                                    {{fieldNames["organisation_www"]}}
                                </th>
                                <td class="summary-td">
                                    {{project.organisation.website}}
                                </td>
                            </tr>
                        </table>
                    </section>
                </section>
                &nbsp;
            </section>
            <section ng-show="project.approved.themes.length > 0"
                     class="col-md-12">
                <hr>
                <h4>{{fieldNames["approved_themes"]}}</h4>
                <section class="section">
                    <span data-ng-model="project.approved.themes"
                          data-ng-repeat="theme in project.approved.themes"
                          style="margin-right: 2em">
                        <span class="glyphicon glyphicon-tag">
                        </span>&nbsp;{{theme}}
                    </span>
                </section>
                <section class="section"
                         ng-show="project.approved.themes_disambiguation.length > 0">
                    <table class="summary-table">
                        <tr>
                            <th>{{fieldNames["approved_themes_disambiguation"]}}</th>
                            <td class="summary-td">{{project.approved.themes_disambiguation}}</td>
                        </tr>
                    </table>
                </section>
            </section>
        </div>
    </article>
    <article id="description" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideDescription = !hideDescription">
                    <span class="glyphicon"
                          ng-class="hideDescription
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    {{fieldNames["description"]}}
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideDescription">
            <span ng-bind-html="handleEmphasis(project.description)">
            </span>
        </section>
    </article>
    <article class="panel panel-primary" ng-show="nonEmpty(project.description_en)">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideDescriptionEn = !hideDescriptionEn">
                    <span class="glyphicon"
                          ng-class="hideDescriptionEn
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    {{fieldNames["description_en"]}}
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideDescriptionEn">
            <span ng-bind-html="handleEmphasis(project.description_en)">
            </span>
        </section>
    </article>
    <article id="details" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideDetails = !hideDetails">
                    <span class="glyphicon"
                          ng-class="hideDetails
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Lisätiedot
                </span>
            </h4>
        </div>
        <section id="appinfo" class="panel-body" ng-hide="hideDetails">
            <div ng-show="nonEmpty(project.context)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["context"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.context)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.project_goal)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["project_goal"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.project_goal)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.target_group)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["target_group"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.target_group)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.planned_results)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["planned_results"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.planned_results)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.indicators)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["indicators"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.indicators)"></span>
                </div>
            </div>
            <div class="col-md-12" style="margin-bottom: 1em"
                 ng-show="project.methods.length > 0">
                <div class="col-md-4 mini-header">
                    {{fieldNames["methods"]}}
                </div>
                <div class="col-md-8">
                    <div ng-repeat="method in project.methods">
                        <em>{{method.name}}</em> ({{method.level}})
                        <p class="subsection">
                            <span ng-bind-html="handleEmphasis(method.comment)"></span>
                        </p>
                    </div>
                </div>
            </div>
            <div ng-show="nonEmpty(project.human_resources)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["human_resources"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.human_resources)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.gender_aspect)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["gender_aspect"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.gender_aspect)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.vulnerable_groups)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["vulnerable_groups"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.vulnerable_groups)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.risk_control)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["risk_control"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.risk_control)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.reporting_evaluation)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["reporting_evaluation"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.reporting_evaluation)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.budget)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["budget"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.budget)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.other_donors_proposed)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["other_donors_proposed"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.other_donors_proposed)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.referees)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["referees"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.referees)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.background_check)"
                 class="col-md-12">
                <div class="col-md-4 mini-header">
                    {{fieldNames["background_check"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.background_check)"></span>
                </div>
            </div>
        </section>
    </article>
    <article id="assessment" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideAssessment = !hideAssessment">
                    <span class="glyphicon"
                          ng-class="hideAssessment
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Arvio
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideAssessment">
            <div ng-show="nonEmpty(project.fitness)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["fitness"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.fitness)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.capacity)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["capacity"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.capacity)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.feasibility)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["feasibility"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.feasibility)"></span>
                </div>
            </div>
            <div ng-show="nonEmpty(project.effectiveness)"
                 class="col-md-12" style="margin-bottom: 1em">
                <div class="col-md-4 mini-header">
                    {{fieldNames["effectiveness"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.effectiveness)"></span>
                </div>
            </div>
<!--            <div ng-show="nonEmpty(project.proposed_funding)"
                 class="col-md-12">
                <div class="col-md-4 mini-header">
                    {{fieldNames["proposed_funding"]}}
                </div>
                <div class="col-md-8">
                    <span ng-bind-html="handleEmphasis(project.proposed_funding)"></span>
                </div>
            </div>-->
        </section>
    </article>
    <article id="special_notes" class="panel panel-primary"
             ng-show="project.special_notes">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideSpecialNotes = !hideSpecialNotes">
                    <span class="glyphicon"
                          ng-class="hideSpecialNotes
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    {{fieldNames["special_notes"]}}
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideSpecialNotes">
            <span ng-bind-html="handleEmphasis(project.special_notes)">
            </span>
        </section>
    </article>
    <article id="schedule" class="panel panel-primary"
             ng-show="project.signed.intreport_deadlines.length > 0">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideSchedule = !hideSchedule">
                    <span class="glyphicon"
                          ng-class="hideSchedule
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Suunniteltu aikataulu
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideSchedule">
            <h5>{{fieldNames["signed_intreport_deadlines"]}}</h5>
            <div ng-repeat="deadline in project.signed.intreport_deadlines" class="subsection col-md-12">
                <div class="col-md-3 mini-header">
                    {{deadline.report}}
                </div>
                <div class="col-md-9">
                    {{deadline.date| date: 'd.M.yyyy': '+0200'}}
                </div>
            </div>
        </section>
    </article>
    <article id="reports" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideReports = !hideReports">
                    <span class="glyphicon"
                          ng-class="hideReports
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Toteutunut aikataulu
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideReports">
            <section ng-show="project.in_review.date"
                     class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showReviewDetails = !showReviewDetails">
                            <span class="glyphicon"
                                  ng-class="showReviewDetails
                                                          ? 'glyphicon-collapse-down'
                                                          : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["in_review_date"]}}
                        </span>
                    </div>
                    <div class="col-md-8">
                        {{project.in_review.date| date:'d.M.yyyy': '+0200'}}
                    </div>
                    &nbsp;
                </div>
                <div id="reviewinfo" class="panel-body"
                     ng-show="showReviewDetails">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["in_review_user"]}}
                        </div>
                        <div class="col-md-9">{{project.in_review.user}},
                            {{project.in_review.date| date:'d.M.yyyy, HH:mm': '+0200'}}</div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["in_review_comments"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.in_review.comments}}
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.approved.date"
                     class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showApprovedDetails = !showApprovedDetails">
                            <span class="glyphicon"
                                  ng-class="showApprovedDetails
                                                          ? 'glyphicon-collapse-down'
                                                          : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["approved_date"]}}
                        </span>
                    </div>
                    <div class="col-md-1">
                        {{project.approved.date| date:'d.M.yyyy':'+0200'}}
                    </div>
                    <div class="col-md-1">
                        <a ng-href="/projects/{{project._id}}/regreport"
                           target="_blank" class="btn btn-default btn-xs"
                           style="margin-top: -4px">
                            <span class="glyphicon glyphicon-globe"></span>&nbsp;
                            HTML
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a ng-click="createPDF('reg')" href=""
                           ng-disabled="regRepExists"
                           class="btn btn-default btn-xs"
                           style="margin-top: -4px"
                           title="PDF-tiedosto tallentuu liitteenä.">
                            <span class="glyphicon glyphicon-file"></span>&nbsp;
                            PDF
                        </a>
                    </div>
                    &nbsp;
                </div>
                <div id="approvedinfo" class="panel-body"
                     ng-show="showApprovedDetails">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["approved_user"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.approved.user}},
                            {{project.approved.date| date:'d.M.yyyy, HH:mm': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["approved_approved_by"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.approved.approved_by}}
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["approved_approved_date"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.approved.approved_date| date: 'd.M.yyyy':'+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["approved_board_notified"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.approved.board_notified| date:'d.M.yyyy':'+0200'}}
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.rejected.date"
                     class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showRejectedDetails = !showRejectedDetails">
                            <span class="glyphicon"
                                  ng-class="showRejectedDetails
                                                          ? 'glyphicon-collapse-down'
                                                          : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["rejected_date"]}}
                        </span>
                    </div>
                    <div class="col-md-8">
                        {{project.rejected.date| date:'d.M.yyyy': '+0200'}}
                    </div>
                    &nbsp;
                </div>
                <div id="rejectedinfo" class="panel-body"
                     ng-show="showRejectedDetails">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["rejected_user"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.rejected.user}},
                            {{project.rejected.date|date:'d.M.yyyy, HH:mm': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["rejected_rejection_categories"]}}
                        </div>
                        <div class="col-md-9">
                            <ul>
                                <li ng-repeat="rej in project.
                                                    rejected.rejection_categories">
                                    {{rej.rejection}}
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["rejected_rejection_comments"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.rejected.rejection_comments}}
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.signed.date" class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showSignedDetails = !showSignedDetails">
                            <span class="glyphicon"
                                  ng-class="showSignedDetails ? 'glyphicon-collapse-down' : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["signed_date"]}}
                        </span>
                    </div>
                    <div class="col-md-8">
                        {{project.signed.date| date:'d.M.yyyy': '+0200'}}
                    </div>
                    &nbsp;
                </div>
                <div id="signedinfo" class="panel-body"
                     ng-show="showSignedDetails">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["signed_user"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.signed.user}},
                            {{project.signed.date|date:'d.M.yyyy, HH:mm': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["signed_signed_by"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.signed.signed_by}},
                            {{project.signed.signed_date|date:'d.M.yyyy': '+0200'}}
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.intermediary_reports.length > 0">
                <div ng-repeat="intreport in project.intermediary_reports"
                     class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="col-md-4 mini-header">
                            &nbsp;
                            <span ng-click="showIntDetails = !showIntDetails">
                                <span class="glyphicon"
                                      ng-class="showIntDetails ? 'glyphicon-collapse-down' : 'glyphicon-collapse-up'">
                                </span>
                                {{intreport.reportNumber}}.
                                {{fieldNames["intreport_date"]}}
                            </span>
                        </div>
                        <div class="col-md-1">
                            {{intreport.date| date:'d.M.yyyy': '+0200'}}
                        </div>
                        <div class="col-md-1">
                            <a ng-href="/projects/{{project._id}}/intreport/{{intreport.reportNumber}}"
                               target="_blank" class="btn btn-default btn-xs"
                               style="margin-top: -4px">
                                <span class="glyphicon glyphicon-globe"></span>&nbsp;
                                HTML
                            </a>
                        </div>
                        <div class="col-md-6">
                            <a ng-click="createPDF('int')" href=""
                               ng-disabled="true" class="btn btn-default btn-xs"
                               style="margin-top: -4px"
                               title="PDF-tiedosto tallentuu liitteenä.">
                                <span class="glyphicon glyphicon-file"></span>&nbsp;
                                PDF
                            </a>
                        </div>
                        &nbsp;
                    </div>
                    <div ng-show="showIntDetails" class="panel-body">
                        <div class="col-md-12" style="margin-bottom: 1em">
                            <div class="col-md-3 mini-header">
                                {{fieldNames["intreport_user"]}}
                            </div>
                            <div class="col-md-9">
                                {{intreport.user}},
                                {{intreport.date|date:'d.M.yyyy, HH:mm': '+0200'}}
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 mini-header">
                                Raportin esitteli
                            </div>
                            <div class="col-md-9">
                                {{intreport.approved_by}},
                                {{intreport.date_approved|date : 'd.M.yyyy': '+0200'}}
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.end_report.date"
                     class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showEndDetails = !showEndDetails">
                            <span class="glyphicon"
                                  ng-class="showEndDetails ? 'glyphicon-collapse-down' : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["end_report_date"]}}
                        </span>
                    </div>
                    <div class="col-md-1">
                        {{project.end_report.date| date:'d.M.yyyy':'+0200'}}
                    </div>
                    <div class="col-md-1">
                        <a ng-href="/projects/{{project._id}}/endReport"
                           target="_blank" class="btn btn-default btn-xs"
                           style="margin-top: -4px">
                            <span class="glyphicon glyphicon-globe"></span>&nbsp;
                            HTML
                        </a>
                    </div>
                    <div class="col-md-1">
                        <a ng-click="createPDF('end')" href=""
                           ng-disabled="endRepExists || nonPDFfinancialRep"
                           class="btn btn-default btn-xs"
                           style="margin-top: -4px">
                            <span class="glyphicon glyphicon-file"></span>&nbsp;
                            PDF
                        </a>
                    </div>
                    <div class="col-md-5 text-warning"
                         ng-show="!financialRepExists">
                        <span class="glyphicon glyphicon-exclamation-sign"></span>
                        <small>Talousraportti puuttuu</small>
                    </div>
                    &nbsp;
                </div>
                <div ng-show="showEndDetails" class="panel-body">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["end_report_user"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.end_report.user}},
                            {{project.end_report.date|date:'d.M.yyyy, HH:mm': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            Raportti hyväksytty
                        </div>
                        <div class="col-md-9">
                            {{project.end_report.approved_by}},
                            {{project.end_report.approved_date|date : 'd.M.yyyy': '+0200'}}
                        </div>
                    </div>
                </div>
            </section>
            <section ng-show="project.ended.date" class="panel panel-primary">
                <div class="panel-heading">
                    <div class="col-md-4 mini-header">
                        &nbsp;
                        <span ng-click="showEndedDetails = !showEndedDetails">
                            <span class="glyphicon"
                                  ng-class="showEndedDetails
                                                          ? 'glyphicon-collapse-down'
                                                          : 'glyphicon-collapse-up'">
                            </span>
                            {{fieldNames["ended_date"]}}
                        </span>
                    </div>
                    <div class="col-md-8">
                        {{project.ended.end_date| date:'d.M.yyyy':'+0200'}}
                    </div>
                    &nbsp;
                </div>
                <div id="endedinfo" class="panel-body"
                     ng-show="showEndedDetails">
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["ended_user"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.ended.user}},
                            {{project.ended.date|date:'d.M.yyyy, HH:mm': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">Hyväksyjä</div>
                        <div class="col-md-9">
                            {{project.ended.approved_by}}
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-bottom: 1em">
                        <div class="col-md-3 mini-header">
                            {{fieldNames["ended_board_notified"]}}
                        </div>
                        <div class="col-md-9">
                            {{project.ended.board_notified|date: 'd.M.yyyy': '+0200'}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-3 mini-header">
                            Muut päättämiseen liittyvät kommentit
                        </div>
                        <div class="col-md-9">
                            {{project.ended.other_comments}}
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </article>
    <article id="stateTransition" class="panel panel-primary"
             ng-show="state.next.length !== 0 && project.state !== 'hylätty' && project.state !== 'päättynyt'">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideStateTransition = !hideStateTransition">
                    <span class="glyphicon"
                          ng-class="hideStateTransition
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Tilasiirtymä
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideStateTransition">
            <form name="stateForm" class="form-horizontal"
                  data-ng-init="findState()"
                  data-ng-submit="changeState(project.changeTo);">
                <span>
                    <label class="control-label">
                        {{project.state}}
                        <span ng-if="project.incomplete"> (keskeneräinen)</span>
                    </label>
                    <span class="glyphicon glyphicon-arrow-right"></span>
                    <select id="stateSelect" data-ng-model="project.changeTo"
                            required>
                        <option value="" selected>[Siirry tilaan]</option>
                        <option data-ng-repeat="next_state in state.next_states"
                                value="{{next_state}}">{{next_state}}</option>
                    </select>
                </span>
                <span style="float: right">
                    <button type="submit" class="btn btn-default" id="st"
                            ng-disalbed="stateform.$invalid">
                        <span class="glyphicon glyphicon-share-alt"></span>&nbsp;
                        Lomake
                    </button>
                </span>
            </form>
        </section>
    </article>
    <article id="payments" class="panel panel-primary"
             ng-show="project.approved.date">
        <div class="panel-heading">
            <h4>
                <span ng-click="hidePayments = !hidePayments">
                    <span class="glyphicon"
                          ng-class="hidePayments
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Maksatus
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hidePayments">
            <section class="section" style="margin-left: 1em">
                <section class="col-md-12">
                    <div class="col-md-2 mini-header">
                        <div ng-show="project.approved.granted_sum_eur">
                            Myönnetty avustus
                            <!--{{fieldNames["approved_granted_sum_eur"]}}-->
                        </div>
                    </div>
                    <div class="col-md-2">
                        {{numberToString(project.approved.granted_sum_eur)}} EUR
                    </div>
                    <div class="col-md-8">
                        {{project.approved.approved_date| date:'d.M.yyyy': '+0200'}}
                    </div>
                </section>
                <section class="col-md-12">
                    <div class="col-md-2 mini-header">Maksettu yhteensä</div>
                    <div class="col-md-10">
                        {{numberToString(project.funding.paid_eur)}} EUR
                    </div>
                </section>
                <section ng-show="project.signed.date" class="col-md-12">
                    <div class="col-md-2 mini-header">Jäljellä</div>
                    <div class="col-md-10">
                        {{numberToString(project.funding.left_eur)}} EUR
                    </div>
                </section>
                &nbsp;
            </section>
            <hr>
            <section class="col-md-12" style="margin-left: -2em">
                <section class="col-md-6" ng-show="project.signed.planned_payments.length > 0">
                    <h5>Maksuaikataulu</h5>
                    <section
                        ng-repeat="planned_payment in project.signed.planned_payments">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <em>{{project.signed.planned_payments.indexOf(planned_payment) + 1}}. erä</em>
                            </div>
                            <div class="col-md-4">
                                {{numberToString(planned_payment.sum_eur)}} EUR
                            </div>
                            <div class="col-md-6">
                                {{planned_payment.date| date:'d.M.yyyy': '+0200'}}
                            </div>
                        </div>
                    </section>
                </section>
                <section class="col-md-6" ng-show="!(project.signed.planned_payments.length > 0)">
                    [Ei suunniteltuja maksuja.]
                </section>
                <section ng-show="project.payments.length > 0" class="col-md-6">
                    <h5>Maksetut erät</h5>
                    <section ng-repeat="payment in project.payments| orderBy: 'payment_date'">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <em id="paid">{{$index + 1}}. erä</em>
                            </div>
                            <div class="col-md-4">
                                {{numberToString(payment.sum_eur)}} EUR
                            </div>
                            <div class="col-md-4">
                                {{payment.payment_date| date:'d.M.yyyy': '+0200'}}
                            </div>
                            <div class="col-md-2">
                                <a href=""
                                   data-ng-click="confirmPaymentDeletion(payment.payment_number, $index + 1)">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </a>
                            </div>
                        </div>
                    </section>
                </section>
                <section class="col-md-6" ng-show="!(project.payments.length > 0)">
                    [Ei toteutuneita maksuja.]
                </section>
                &nbsp;
            </section>
            &nbsp;
        </section>
    </article>
    <article id="addPayment" ng-show="project.signed.date"
             class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideAddPayment = !hideAddPayment">
                    <span class="glyphicon"
                          ng-class="hideAddPayment
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Maksun lisäys
                </span>
            </h4>
        </div>
        <section class="panel-body" style="margin-bottom: -2em" ng-hide="hideAddPayment">
            <form name="paymentForm" class="form-horizontal" role="form"
                  data-ng-submit="addPaymentInfo(paymentForm.$valid)"
                  novalidate>
                <div style="margin-left: -5em">
                    <div class="form-group col-md-6" id="PaymentDate">
                        <label class="col-md-3 control-label">
                            Päiväys
                        </label>
                        <div class="col-md-3"
                             ng-class="{'has-error': paymentForm.paymentDay.$invalid}">
                            <input name="paymentDay" type="number"
                                   ng-trim="true" class="form-control"
                                   data-ng-model="payment_day"
                                   id="paymentDay" required />
                            <div ng-show="paymentForm.paymentDay.$invalid"
                                 class="help-block" >
                                <p ng-show="paymentForm.paymentDay.$error.required">
                                    Päivä on pakollinen
                                </p>
                            </div>
                        </div>
                        <div class="col-md-3"
                             ng-class="{'has-error': paymentForm.paymentMonth.$invalid}">
                            <input name="paymentMonth" type="number"
                                   ng-trim="true" class="form-control"
                                   data-ng-model="payment_month"
                                   id="paymentMonth"
                                   required />
                            <div ng-show="paymentForm.paymentMonth.$invalid"
                                 class="help-block">
                                <p ng-show="paymentForm.paymentMonth.$error.required">
                                    Kuukausi on pakollinen
                                </p>
                            </div>
                        </div>
                        <div class="col-md-3"
                             ng-class="{'has-error': paymentForm.paymentYear.$invalid }">
                            <input name="paymentYear" type="number"
                                   ng-trim="true" class="form-control"
                                   data-ng-model="payment_year"
                                   id="paymentYear"
                                   required />
                            <div ng-show="paymentForm.paymentYear.$invalid"
                                 class="help-block">
                                <p ng-show="paymentForm.paymentYear.$error.required">
                                    Vuosi on pakollinen
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6"
                         ng-class="{'has-error': paymentForm.paymentSumEUR.$invalid}">
                        <label for="paymentSumEUR" class="col-md-4 control-label">
                            Summa (EUR)
                        </label>
                        <div class="col-md-3">
                            <input name="paymentSumEUR" type="number"
                                   ng-trim="true" class="form-control"
                                   data-ng-model="project.payment.sum_eur"
                                   id="paymentSumEUR" required />
                        </div>
                        <div class="col-md-4">
                            <div ng-show="paymentForm.paymentSumEUR.$invalid"
                                 class="help-block">
                                <p ng-show="paymentForm.paymentSumEUR.$error.number">
                                    Summan täytyy olla luku
                                </p>
                            </div>
                            <div ng-show="paymentForm.paymentSumEUR.$invalid"
                                 class="help-block">
                                <p ng-show="paymentForm.paymentSumEUR.$error.required">
                                    Kenttä on pakollinen
                                </p>
                            </div>
                        </div>
                        <div class="form-group col-md-1">
                            <button type="submit" id="btn-pay" class="btn btn-primary"
                                    ng-disabled="paymentForm.$invalid">
                                <span class="glyphicon glyphicon-ok"></span>&nbsp;
                                Tallenna
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </article>
    <article id="checklist" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideChecklist = !hideChecklist">
                    <span class="glyphicon"
                          ng-class="hideChecklist
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    {{fieldNames["required_appendices"]}}
                </span>
            </h4>
        </div>
        <div class="panel-body" style="padding-left: 0" ng-hide="hideChecklist">
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_proj_budget"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.proj_budget"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.proj_budget"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_references"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.references"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.references"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_annual_budget"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.annual_budget"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.annual_budget"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_rules"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.rules"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.rules"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_reg_cert"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.reg_cert"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.reg_cert"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_annual_report"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.annual_report"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.annual_report"></span>
                </span>
            </div>
            <div class="col-md-12" style="padding-left: 0">
                <span class="col-md-3">
                    <label>{{fieldNames["required_appendices_audit_reports"]}}</label>
                </span>
                <span class="col-md-9">
                    <span class="glyphicon glyphicon-check"
                          ng-show="project.required_appendices.audit_reports"></span>
                    <span class="glyphicon glyphicon-unchecked"
                          ng-show="!project.required_appendices.audit_reports"></span>
                </span>
            </div>
        </div>
    </article>
    <article id="appendices" class="panel panel-primary"
             ng-show="project.appendices.length > 0">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideAppendices = !hideAppendices">
                    <span class="glyphicon"
                          ng-class="hideAppendices
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Tallennetut liitteet ({{project.appendices.length}} kpl)
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideAppendices">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>
                            <a href="" ng-click="sortBy('category')">
                                <span class="glyphicon"
                                      ng-class="property === 'category' ? (reverse ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up') : 'glyphicon-none'">
                                </span>&nbsp;Liite
                            </a>
                        </th>
                        <th>
                            <a href="" ng-click="sortBy('original_name')">
                                <span class="glyphicon"
                                      ng-class="property === 'original_name' ? (reverse ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up') : 'glyphicon-none'">
                                </span>&nbsp;
                                Alkup. tiedostonimi
                            </a>
                        </th>
                        <th>
                            <a href="" ng-click="sortBy('date')">
                                <span class="glyphicon"
                                      ng-class="property === 'date' ? (reverse ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up') : 'glyphicon-none'">
                                </span>&nbsp;
                                Päivämäärä
                            </a>
                        </th>
                        <th>
                            <span class="glyphicon glyphicon-none">
                            </span>&nbsp;Toiminnot
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="section"
                        ng-repeat="appendix in project.appendices| orderBy:predicate:reverse">
                        <td>
                            <!-- TODO: Figure out how to hyperlink the
                            appendices using client-side services in order to
                            enable proper access control: -->
                            <a ng-href="{{appendix.url}}&action=download"
                               target="_blank">
                                {{appendix.category !== 'Muu...' ?
                                        appendix.category : appendix.custom_category}}
                            </a>
                        </td>
                        <td>
                            <em>{{appendix.original_name}}</em>
                        </td>
                        <td>
                            {{appendix.date| date: 'd.M.yyyy': '+0200'}}
                        </td>
                        <td>
                            <a data-ng-click="confirmAppendixDeletion(
                                                    appendix.category !== 'Muu...' ? appendix.category : appendix.custom_category,
                                                    appendix.url)">
                                <span class="glyphicon glyphicon-trash"></span>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
    </article>
    <article id="addAppendix" class="panel panel-primary">
        <!-- TODO: Figure out how to make this form work through a
        client-side service in order to enable proper acces contol: -->
        <div class="panel-heading">
            <h4>
                <span ng-click="hideAddAppendix = !hideAddAppendix">
                    <span class="glyphicon"
                          ng-class="hideAddAppendix
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Liitteen lisäys
                </span>
            </h4>
        </div>
        <section class="panel-body" style="padding-left: 0" ng-hide="hideAddAppendix">
            <form name="appendixForm" class="form-horizonalsection"
                  action="/api/projects/upload"
                  method="post" enctype="multipart/form-data">
                <input type="hidden" name="project_id" value="{{project._id}}">
                <div class="form-group col-md-10" style="padding-left: 0"
                     ng-class="{'has-error': appendixForm.appendix_category.$invalid}">
                    <label for="appendix_category"
                           class="col-md-2 control-label">
                        Kategoria
                    </label>
                    <select id="appendixTypeSelect" name="appendix_category"
                            class="col-md-3"
                            ng-model="project.appendix.category"
                            ng-options="category for category in appendixCategories"
                            required>
                    </select>
                    <input type="text" name="appendix_custom_category"
                           value="" class="col-md-7"
                           ng-show="project.appendix.category === 'Muu...'"
                           ng-model="project.appendix.customCategory">
                    <div ng-show="appendixForm.appendix_category.$invalid"
                         class="col-md-7 help-block">
                        Liitteelle pitää valita kategoria.
                    </div>
                </div>
                <div class="col-md-10" style="padding-left: 0">
                    <label for="appendix_file" class="col-md-2">
                        Tiedosto
                    </label>
                    <input type="file" id="appendixFileInput"
                           name="appendix_file" class="col-md-6"
                           accept="application/msword,application/pdf,application/rtf,application/vnd.oasis.opendocument.text,text/plain,text/csv,image/*"
                           ng-model="project.appendix.file">
                </div>
                <div class="form-group col-md-2" style="margin-top: -2em">
                    <button type="submit" id="btn-add-appendix"
                            value="Submit" class="btn btn-primary"
                            ng-disabled="appendixForm.$invalid ||
                                        (project.appendix.category === 'Muu...' &&
                                        !project.appendix.customCategory)">
                        <span class="glyphicon glyphicon-ok"></span>&nbsp;
                        Tallenna
                    </button>
                </div>
            </form>
        </section>
    </article>
    <article id="log" class="panel panel-primary">
        <div class="panel-heading">
            <h4>
                <span ng-click="hideLog = !hideLog">
                    <span class="glyphicon"
                          ng-class="hideLog
                                                  ? 'glyphicon-collapse-down'
                                                  : 'glyphicon-collapse-up'">
                    </span>
                    Muokkaukset
                </span>
            </h4>
        </div>
        <section class="panel-body" ng-hide="hideLog">
            <div ng-show="project.updated.length > 0">
                <div data-ng-repeat="update in project.updated"
                     class="col-md-6">
                    <div class="col-md-1 mini-header">{{$index + 1}}.</div>
                    <div class="col-md-11">
                        {{update.time| date: 'd.M.yyyy HH:mm'}};
                        <em>{{update.user}}</em>
                    </div>
                </div>
            </div>
            <div ng-show="project.updated.length === 0">
                Ei muokkauksia.
            </div>
        </section>
    </article>
</article>
