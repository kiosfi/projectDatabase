<section data-ng-controller="ProjectsController"
         data-ng-init="findOneForEndReport()" class="report-body">
    <!-- Note that this page doesn't use bootstrap in order to ensure that the
    text looks similar when viewed through browser and printed (to PDF).-->
    <table>
        <tr>
            <td style="width: 50%">
                <img src="/theme/assets/img/kios_logo_public.gif" alt="KIOS"
                     style="float: left">
            </td>
            <td>
                <table>
                    <tr>
                        <td class="report-mini-header" colspan="2">
                            Loppuraportti
                        </td>
                    </tr>
                    <tr>
                        <td class="report-mini-header">
                            {{fieldNames["end_report_board_meeting"]}}
                        </td>
                        <td class="report-content">
                            {{project.end_report.board_meeting}}
                        </td>
                    </tr>
                    <tr>
                        <td class="report-mini-header">Esittelijä</td>
                        <td class="report-content">
                            {{project.coordinator}}
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <hr>
    <article class="border-body">
        <table>
            <tr>
                <td class="report-mini-header">
                    {{fieldNames["organisation"]}}
                </td>
                <td class="report-content">{{project.organisation.name}}&nbsp;</td>
                <td class="report-mini-header">
                    Hanke
                    <!--{{fieldNames["title"]}}-->
                </td>
                <td class="report-content">{{project.title}}&nbsp;</td>
            </tr>
            <tr>
                <td class="report-mini-header">
                    {{fieldNames["project_ref"]}}
                </td>
                <td class="report-content">{{project.project_ref}}&nbsp;</td>
                <td class="report-mini-header">{{fieldNames["region"]}}</td>
                <td class="report-content">{{project.region}}&nbsp;</td>
            </tr>
            <tr>
                <td class="report-mini-header">Avustus&nbsp;ja&nbsp;pvm</td>
                <td class="report-content">
                    {{numberToString(project.approved.granted_sum_eur)}}
                    EUR;
                    {{project.approved.approved_date| date : 'dd.MM.yyyy': 'UTC'}}&nbsp;
                </td>
                <td class="report-mini-header">Kesto</td>
                <td class="report-content" data-ng-init="calculateDuration()">
                    {{duration}}&nbsp;
                </td>
            </tr>
            <tr><td colspan="4">&nbsp;</td></tr>
            <tr>
                <td class="report-mini-header">
                    {{fieldNames["description"]}}
                </td>
                <td class="report-content" colspan="3">
                    {{project.description}}&nbsp;
                </td>
            </tr>
            <tr><td colspan="4">&nbsp;</td></tr>
            <tr>
                <td class="report-mini-header">Oikeudellinen&nbsp;fokus</td>
                <td class="report-content" colspan="3">
                    <table>
                        <tr ng-repeat="theme in project.approved.themes">
                            <td>{{theme}}</td>
                        </tr>
                    </table>&nbsp;
                </td>
            </tr>
        </table>
    </article>
    <table>
        <tr><td colspan="2">&nbsp;</td></tr>
        <tr>
            <td class="report-header">Järjestö</td>
            <td>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        Tavoitteet ja keskeiset toimintatavat
                    </div>
                    <div class="report-subcontent">
                        {{project.organisation.description}}
                    </div>
                </div>
            </td>
        </tr>
        <tr><td colspan="2">&nbsp;</td></tr>
        <tr>
            <td class="report-header">Hanke</td>
            <!--<td class="report-header">{{fieldNames["title"]}}</td>-->
            <td>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_budget"]}}
                    </div>
                    <div class="report-subcontent">
                        {{project.end_report.budget}}
                    </div>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">Maksatukset</div>
                    <div class="report-subcontent">
                        Hankkeelle myönnettiin
                        {{numberToString(project.approved.granted_sum_eur)}} EUR
                        hallituksen kokousessa
                        {{project.approved.board_notified| date : 'dd.MM.yyyy': 'UTC'}}.</div>
                    <div class="report-subcontent">
                        Sopimus allekirjoitettiin
                        {{project.signed.signed_date| date: 'dd.MM.yyyy': 'UTC'}}.
                    </div>

                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_planned_payments"]}}
                    </div>
                    <table>
                        <tr ng-repeat="planned_payment in project.signed.planned_payments">
                            <td style="padding-left: 2em">
                                <em>{{$index + 1}}. erä</em>
                            </td>
                            <td style="padding-left: 2em">
                                {{numberToString(planned_payment.sum_eur)}} EUR
                            </td>
                            <td style="padding-left: 2em">
                                {{planned_payment.date| date : 'dd.MM.yyyy': 'UTC'}}
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["payments"]}}
                    </div>
                    <table>
                        <tr ng-repeat="payment in project.payments|
                                    orderBy: 'payment_date'">
                            <td style="padding-left: 2em">
                                <em>{{$index + 1}}. erä</em>
                            </td>
                            <td style="padding-left: 2em">
                                {{numberToString(payment.sum_eur)}} EUR
                            </td>
                            <td style="padding-left: 2em">
                                {{payment.payment_date| date : 'dd.MM.yyyy': 'UTC'}}
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="margin-bottom: 2em">
                    <div class="report-mini-header">Jäljellä oleva summa</div>
                    <div class="report-subcontent" style="margin-bottom: 2em">
                        {{numberToString(project.funding.left_eur)}} EUR
                    </div>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_methods"]}}
                    </div>
                    <ul>
                        <li ng-repeat="method in project.methods"
                            style="padding-bottom: 1em">
                            <p><em>{{method.name}}</em> ({{method.level}})</p>
                            <p class="report-subcontent"><em>Suunnitellut:</em>
                                {{method.comment}}</p>
                            <p class="report-subcontent"><em>Toteutuneet:</em>
                                {{project.end_report.methods[project.methods.indexOf(method)]}}</p>
                        </li>
                    </ul>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_objective"]}}
                    </div>
                    <div class="report-subcontent">
                        <p><em>{{project.project_goal}}</em></p>
                        <p>{{project.end_report.objective}}</p>
                    </div>
                </div>
                <div style="margin-bottom: 2em">
                    <div class="report-mini-header">
                        Hyödynsaajien arvioitu määrä
                    </div>
                    <div class="report-subcontent">
                        <p><em>Suoria:</em>
                            {{project.end_report.direct_beneficiaries}}
                        </p>
                        <p><em>Epäsuoria:</em>
                            {{project.end_report.indirect_beneficiaries}}
                        </p>
                    </div>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">Tilintarkastus</div>
                    <div class="report-subcontent">
                        <p><em>Päivämäärä: </em>
                            {{project.end_report.audit.date| date: 'dd.MM.yyyy': 'UTC'}}</p>
                        <p>{{project.end_report.audit.review}}</p>
                    </div>
                </div>
            </td>
        </tr>
        <tr><td colspan="2">&nbsp;</td></tr>
        <tr>
            <td class="report-header">Arvio</td>
            <td>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_grade"]}}:
                        <span style="padding-left: 2em; font-weight: normal">
                            {{project.end_report.grade}}
                        </span>
                    </div>
                    <div class="report-subcontent">
                        {{project.end_report.general_review}}
                    </div>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_proposition"]}}
                    </div>
                    <div class="report-subcontent">
                        {{project.end_report.proposition}}
                    </div>
                </div>
                <div style="margin-bottom: 1em">
                    <div class="report-mini-header">
                        {{fieldNames["end_report_conclusion"]}}
                    </div>
                    <div class="report-subcontent">
                        {{project.end_report.conclusion}}
                    </div>
                </div>
            </td>
        </tr>
    </table>
</section>
