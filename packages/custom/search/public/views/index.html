<h1>Haku</h1>
<br>
<section data-ng-controller="SearchController">

    <h3>Lisää hakukenttiä</h3>
    <article>
        <form name="searchForm" class="form-horizontal col-md-8" role="form" data-ng-submit="search()" novalidate>

            <div class="form-group col-md-12">
                <div class="col-md-12" id="fieldSelection" data-ng-repeat="query in addedQueries">
                    <label class="col-md-6">Valitse hakuparametri:</label>
                    <select id="fieldSelect" data-ng-model="query.field" class="col-md-6" style="float:left;">
                        <option data-ng-repeat="field in fields" value="{{field.name}}">{{field.fi}}</option>
                    </select>
                    <select ng-show="query.field === 'state'" data-ng-model="query.value" class="col-md-6" style="float:left;">
                        <option data-ng-repeat="state in states" value="{{state}}">{{state}}</option>
                    </select>
                    <select ng-show="query.field === 'approved.themes'" data-ng-model="query.value" class="col-md-6" style="float:left;">
                        <option data-ng-repeat="theme in themes" value="{{theme}}">{{theme}}</option>
                    </select>
                    <div ng-show="query.field === 'region'" class="col-md-6" style="float:left">
                        <input type="text" class="form-control" data-ng-model="query.value" placeholder="Kirjoita hakusana(t)">
                    </div>
                    <div style="clear:both;">&nbsp;</div>
                </div>

                <div class="col-md-12">
                    <input type="button" value="Lisää hakukenttä" ng-click="addQuery();"/>
                    <input type="button" ng-show="addedQueries.length > 0" value="Poista viimeinen" ng-click="removeQuery();"/>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-10">
                    <button id="appr-btn" type="submit" class="btn btn-default">Hae</button>
                </div>
            </div>
        </form>
        <div style="clear:both;">&nbsp;</div>
    </article>

    <article class="search">
        <h4>Hakutulokset</h4>
        <p>Löydettyjen hankkeiden määrä: {{results.length}}</p>
        <button type="button" ng-csv="parsedData" lazy-load="true" csv-header="['Tunnus', 'Tila', 'Hanke', 'Koordinaattori', 'Järjestö', 
                'Kuvaus', 'Kuvaus (eng)', 'Kesto (kk)', 'Haettu summa (eur)', 'Hyväksytty summa (eur)', 'Jäljellä (eur)', 'Hankkeen taustat', 'Gender analyysi', 'Edunsaajat', 'Tavoitteet', 
                'Raportointi', 'Kestävyys ja riskit', 'Muut rahoittajat', 'Alue', 'DAC', 'Käsittelyyn (pvm)', 'Käsittelyn kommentit', 'Hyväksytty (pvm)',
                'Hyväksyjä', 'Toimintatavat', 'Teemat', 'Allekirjoitettu (pvm)', 'Allekirjoittaja', 'Raporttien aikataulu', 'Maksusuunnitelma', 
                'Hylätty (pvm)', 'Hylkäyssyyt', 'Hylkäys kommentit', 'Maksatukset', 'Loppuraportti hyväksytty (pvm)', 'Loppuraportin hyväksyjä', 'Tilintarkastus (pvm)',
                'Tilintarkastus arvio', 'Kios:in arvio', 'Loppuraportin kommentit', 'Loppuraportti - toimintatapojen arvio', 'Loppuraportti - tavoitteiden arvio']" 
                filename="tiedot.csv" field-separator=";" add-bom="true">Lataa tulokset tiedostoon</button>
        <table class="col-md-12 table table-striped">
            <thead>
                <!-- TODO: Check the names for the ordering predicates. -->
                <tr>
                    <th class="col-md-1">Tunnus</th>
                    <th class="col-md-3">Hanke</th>
                    <th class="col-md-3">Järjestö</th>
                    <th class="col-md-5">Kuvaus</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="result in results| orderBy: 'project_ref'">
                    <td>{{result.project_ref}}</td>
                    <td><a ng-href="/projects/{{result._id}}" target="_blank">
                            {{result.title}}</a></td>
                    <td><a ng-href="/organisations/{{result.organisation._id}}" target="_blank">{{result.organisation.name}}</a>
                    </td>
                    <td>{{result.description}}</td>
                </tr>
            </tbody>
        </table>
    </article>

</section>
