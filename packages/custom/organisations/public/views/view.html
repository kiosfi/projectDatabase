<section data-ng-controller="OrganisationsController" data-ng-init="findOne()">
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-jquery/dist/angular-jquery.min.js"></script>
    <script src="bower_components/angular-bootstrap-affix/dist/angular-bootstrap-affix.min.js"></script>
    <script src="scripts/app.js"></script>
    <div id="header">
        <h1>{{organisation.name}}</h1>
        <hr>
    </div>
    <ul id="menu" class="nav nav-list navtree">
        <li>
            <label><a href="#functions">Toiminnot</a></label>
            <ul>
                <li>
                    <a ng-href="/organisations/{{organisation._id}}/edit">
                        Muokkaus
                    </a>
                </li>
                <li><a data-ng-click="confirm(organisation);">Poisto</a></li>
            </ul>
        </li>
        <li>
            <label><a href="#header">Järjestö</a></label>
            <ul>
                <li><a href="#summary">Perustiedot</a></li>
                <li><a href="#legalStatus">Hallintomalli ja henkilöstö</a></li>
                <li><a href="#description">Tavoitteet ja toimintatavat</a></li>
                <li><a href="#connections">Yhteydet</a></li>
                <li><a href="#bankInfo">Tilitiedot</a></li>
                <li><a href="#prevApp">Muut hankkeet</a></li>
                <li><a href="#otherDonors">Taloustilanne</a></li>
                <li><a href="#background">Taustatiedot</a></li>
                <li ng-show="organisation.special_notes">
                    <a href="#special_notes">Erityishuomioita</a>
                </li>
            </ul>
            <label><a href="#log">Muokkaukset</a></label>
        </li>
    </ul>
    <article id="functions" class="panel panel-primary">
        <section class="panel-body" style="text-align: center">
            <big>
                <a id="edit" ng-href="/organisations/{{organisation._id}}/edit"
                   class="btn btn-default" style="margin-right: 1em">
                    <span class="glyphicon glyphicon-edit"></span>&nbsp;Muokkaus
                </a>
                <a id="delete" data-ng-click="confirm(organisation);"
                   class="btn btn-danger">
                    <span class="glyphicon glyphicon-trash"></span>&nbsp;Poisto
                </a>
            </big>
        </section>
    </article>
    <article id="summary" class="panel panel-primary">
        <div class="panel-heading"><h4>Perustiedot</h4></div>
        <section class="panel-body">
            <section class="col-md-6">
                <h4>Järjestö</h4>
                <section class="panel-body">
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">Edustaja</div>
                        <div class="col-md-7">
                            {{organisation.representative.name}}<br>
                            {{organisation.representative.email}}<br>
                            {{organisation.representative.phone}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">
                            Vastuullinen johtaja
                        </div>
                        <div class="col-md-7">
                            {{organisation.exec_manager}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">
                            Viestintävastaava
                        </div>
                        <div class="col-md-7">
                            {{organisation.communications_rep}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">Osoite</div>
                        <div class="col-md-7">
                            {{organisation.address.street}}<br>
                            {{organisation.address.postal_code}}
                            {{organisation.address.city}}<br>
                            {{organisation.address.country}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">Puhelinnumero</div>
                        <div class="col-md-7">{{organisation.tel}}</div>

                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">Sähköposti</div>
                        <div class="col-md-7">
                            <a href="mailto:{{organisation.email}}">
                                {{organisation.email}}
                            </a>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-5 mini-header">Websivut</div>
                        <div class="col-md-7">
                            <a href="{{
                                        organisation.website.startsWith('http://') ?
                                                organisation.websiet :
                                                'http://' + organisation.website}}">
                                {{organisation.website}}
                            </a>
                        </div>
                    </div>
                </section>
            </section>
            <section class="col-md-6">
                <h4>Tilitiedot</h4>
                <section class="panel-body">
                    <div class="col-md-12">
                        <div class="col-md-4 mini-header">Tilin haltija</div>
                        <div class="col-md-8">
                            {{organisation.bank_account.holder_name}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4 mini-header">
                            Tilinumero (IBAN)
                        </div>
                        <div class="col-md-8">
                            {{organisation.bank_account.iban}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4 mini-header">SWIFT</div>
                        <div class="col-md-8">
                            {{organisation.bank_account.swift}}
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4 mini-header">
                            Pankin yhteystiedot
                        </div>
                        <div class="col-md-8">
                            {{organisation.bank_account.bank_contact_details}}
                        </div>
                    </div>
                </section>
            </section>
        </section>
    </article>
    <article id="prevApp" class="panel panel-primary"
             data-ng-init="findOrgProjects()">
        <div class="panel-heading">
            <h4>
                KIOSilta rahoitusta hakeneet hankkeet
                ({{orgProjects.length}} kpl)
            </h4>
        </div>
        <section class="panel-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>
                            <a ng-click="sortBy('title')">
                                <span ng-show="property === 'title'"
                                      class="glyphicon"
                                      ng-class="reverse ? 'glyphicon-triangle-bottom' : 'glyphicon-triangle-top'">
                                </span>
                                Hanke
                            </a>
                        </th>
                        <th>
                            <a ng-click="sortBy('approved.granted_sum_eur')">
                                <span ng-show="property === 'approved.granted_sum_eur'"
                                      class="glyphicon"
                                      ng-class="reverse ? 'glyphicon-triangle-bottom' : 'glyphicon-triangle-top'">
                                </span>
                                Myönnetty avustus
                            </a>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="project in orgProjects| orderBy:property:reverse">
                        <td>
                            <a data-ng-href="/projects/{{project._id}}">
                                {{project.title}}
                            </a>
                        </td>
                        <td>
                            {{project.approved.granted_sum_eur ? numberToString(project.approved.granted_sum_eur) + " EUR" : "-"}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <div data-ng-if="!orgProjects.length">
                Ei rahoitusta hakeneita hankkeita
            </div>
        </section>
    </article>
    <article id="legalStatus" class="panel panel-primary">
        <div class="panel-heading"><h4>Hallintomalli ja henkilöstö</h4></div>
        <section class="panel-body">
            {{organisation.legal_status}}
        </section>
    </article>
    <article id="description" class="panel panel-primary">
        <div class="panel-heading">
            <h4>Tavoitteet ja keskeiset toimintatavat</h4>
        </div>
        <section class="panel-body">
            {{organisation.description}}
        </section>
    </article>
    <article id="connections" class="panel panel-primary">
        <div class="panel-heading"><h4>Kansalliset yhteydet</h4></div>
        <section class="panel-body">
            {{organisation.nat_local_links}}
        </section>
    </article>
    <article class="panel panel-primary">
        <div class="panel-heading"><h4>Kansainväliset yhteydet</h4></div>
        <section class="panel-body">
            {{organisation.int_links}}
        </section>
    </article>
    <article id="otherDonors" class="panel panel-primary">
        <div class="panel-heading"><h4>Muut rahoittajat ja budjetti</h4></div>
        <section class="panel-body">
            {{organisation.other_funding_budget}}
        </section>
    </article>
    <article class="panel panel-primary">
        <div class="panel-heading"><h4>Taloushallinto ja tilintarkastus</h4></div>
        <section class="panel-body">
            {{organisation.accounting_audit}}
        </section>
    </article>
    <article id="background" class="panel panel-primary">
        <div class="panel-heading"><h4>Oleelliset taustatiedot</h4></div>
        <section class="panel-body">
            {{organisation.background}}
        </section>
    </article>
    <article id="special_notes" class="panel panel-primary"
             ng-show="organisation.special_notes">
        <div class="panel-heading"><h4>Erityishuomioita</h4></div>
        <section class="panel-body">
            {{organisation.special_notes}}
        </section>
    </article>
    <article id="log" class="panel panel-primary">
        <div class="panel-heading"><h4>Muokkaukset</h4></div>
        <section class="panel-body">
            <div ng-show="organisation.updated.length > 0">
                <div data-ng-repeat="update in organisation.updated"
                     class="col-md-6">
                    <div class="mini-header col-md-1">{{$index + 1}}.</div>
                    <div class="col-md-11">
                        {{update.time| date: 'dd.MM.yyyy HH:mm'}};
                        <em>{{update.user}}</em>
                    </div>
                </div>
            </div>
            <div ng-show="organisation.updated.length === 0">
                Ei muokkauksia.
            </div>
        </section>
    </article>
</section>
